general:
  artifacts:
    - "htmlcov"
    - doc/build/html

machine:
  environment:
    LD_LIBRARY_PATH: /usr/local/lib/x86_64-linux-gnu/
  post:
    - pyenv global 3.5.2

dependencies:
  cache_directories:
    - ~/nanomsg-1.0.0
    - ~/.tox
    - ~/CircleCore/.tox

  pre:
    - |
      if [ ! -d ~/nanomsg-1.0.0 ]; then
        cd ~
        wget https://github.com/nanomsg/nanomsg/archive/1.0.0.tar.gz
        tar zxvf 1.0.0.tar.gz
        cd nanomsg-1.0.0
        if [ -d build ]; then
          rm -rdf build
        fi
        mkdir build && cd build
        cmake ..
        cmake --build .
      fi
    - |
      if [ ! -d /usr/local/include/nanomsg ]; then
        cd ~/nanomsg-1.0.0/build
        ctest -C Debug .
        sudo cmake --build . --target install
        sudo ldconfig
      fi
